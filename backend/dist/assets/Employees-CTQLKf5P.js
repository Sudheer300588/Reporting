import{ah as L,B as i,aj as d,aB as l,ak as e,aC as E,aD as O,aE as Z,aF as _}from"./index-CPERY6Kl.js";import{u as T}from"./permissions-C8EIoUeu.js";import{T as V,a as X,S as G,b as H,c as J}from"./trash-2-BwB7RpK0.js";const Y=()=>{const{user:y}=L(),{hasFullAccess:g,hasPermission:A}=T(y),[f,m]=i.useState([]),[C,S]=i.useState(!0),[R,x]=i.useState(!1),[n,j]=i.useState(null),[a,o]=i.useState({name:"",email:"",password:"",roleId:""}),[w,k]=i.useState(!1),[N,b]=i.useState([]),[P,v]=i.useState(!0);i.useEffect(()=>{p(),z()},[y]);const z=async()=>{try{v(!0);const t=(await d.get("/api/roles")).data.data?.filter(r=>r.isActive)||[];let c=t;g()||(c=t.filter(r=>!r.fullAccess)),b(c)}catch(s){console.error("Error fetching roles:",s),b([])}finally{v(!1)}},D=()=>{k(s=>!s)},p=async()=>{try{const s=await d.get("/api/users");m(s.data.users||[])}catch(s){l.error("Error fetching employees"),console.error(s)}finally{S(!1)}},M=async s=>{if(s.preventDefault(),!n){if(!a.password){l.error("Password is required");return}if(a.password.length<8){l.error("Password must be at least 8 characters");return}if(!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]).+$/.test(a.password)){l.error("Password must contain uppercase, lowercase, number, and special symbol");return}}if(!a.roleId){l.error("Please select a role");return}try{if(n){const t={name:a.name,email:a.email,customRoleId:parseInt(a.roleId)};await d.put(`/api/users/${n.id}`,t),l.success("Employee updated successfully")}else{const t={name:a.name,email:a.email,password:a.password,customRoleId:parseInt(a.roleId)};await d.post("/api/users",t),l.success("Employee created successfully")}p(),u()}catch(t){const c=t.response?.data?.error?.message||t.response?.data?.message||"Operation failed";l.error(c)}},U=s=>{j(s),o({name:s.name,email:s.email,password:"",roleId:s.customRoleId?.toString()||""}),x(!0)},$=async s=>{if(window.confirm("Are you sure you want to delete this employee?"))try{await d.delete(`/api/users/${s}`),l.success("Employee deleted successfully"),p()}catch(t){l.error(t.response?.data?.message||"Failed to deactivate employee")}},q=async s=>{const t=!s.isActive;m(c=>c.map(r=>r.id===s.id?{...r,isActive:t}:r));try{await d.put(`/api/users/${s.id}`,{isActive:t}),t?l.success("Employee Reactivated"):l.error("Employee Deactivated")}catch(c){m(r=>r.map(h=>h.id===s.id?{...h,isActive:s.isActive}:h)),l.error(c.response?.data?.message||"Failed to update employee status")}},u=()=>{x(!1),j(null),o({name:"",email:"",password:"",roleId:""})},F={superadmin:"badge-superadmin",admin:"badge-admin",manager:"badge-manager",employee:"badge-employee",telecaller:"badge-telecaller"},B=g()||A("Users","Create");return C||P?e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex items-center justify-center h-64",children:e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-primary-600"})})}):e.jsxs("div",{className:"max-w-7xl pb-4 mx-auto px-4 sm:px-6 lg:px-8 animate-fade-in",children:[e.jsxs("div",{className:"card",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-900",children:"Employee Management"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Manage employees and their roles"})]}),B&&e.jsxs("button",{onClick:()=>x(!0),className:"btn btn-primary",children:[e.jsx(E,{size:16}),"Add Employee"]})]}),f.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(E,{className:"mx-auto h-12 w-12 text-gray-400 mb-4"}),e.jsx("p",{className:"text-gray-500",children:"No employees found."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Name"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Created By"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:f.map((s,t)=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:s.name.charAt(0).toUpperCase()+s.name.slice(1)}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`badge ${F[s.role]}`,children:s.customRole?.name||s.role.charAt(0).toUpperCase()+s.role.slice(1)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:s.createdBy?.name.charAt(0).toUpperCase()+s.createdBy?.name.slice(1)||"System"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsx("div",{className:"flex space-x-2",children:e.jsx("button",{onClick:()=>q(s),className:"focus:outline-none",title:s.isActive?"Deactivate":"Reactivate",children:s.isActive?e.jsx(V,{className:"text-green-500",size:22}):e.jsx(X,{className:"text-gray-400",size:22})})})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.jsxs("div",{className:"flex space-x-2",children:[e.jsx("button",{onClick:()=>U(s),className:"text-indigo-600 hover:text-indigo-900",title:"Edit Employee",children:e.jsx(G,{size:16})}),e.jsx("button",{onClick:()=>$(s.id),className:"text-red-600 hover:text-red-900",title:"Delete Employee",children:e.jsx(H,{size:16})})]})})]},t))})]})})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50",children:e.jsxs("div",{className:"relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white",children:[e.jsxs("div",{className:"flex justify-between items-center mb-4",children:[e.jsx("h3",{className:"text-lg font-medium text-gray-900",children:n?"Edit Employee":"Create New Employee"}),e.jsx("button",{onClick:u,className:"text-gray-400 hover:text-gray-600",children:e.jsx(O,{size:20})})]}),e.jsxs("form",{onSubmit:M,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Name"}),e.jsx("input",{type:"text",value:a.name,onChange:s=>o({...a,name:s.target.value}),className:"form-input",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Email"}),e.jsx("input",{type:"email",value:a.email,onChange:s=>o({...a,email:s.target.value}),className:"form-input",required:!0})]}),!n&&e.jsxs("div",{children:[e.jsx("label",{className:"form-label",children:"Password"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:w?"text":"password",value:a.password,onChange:s=>o({...a,password:s.target.value}),className:"form-input",required:!0,minLength:"6"}),e.jsx("button",{type:"button",className:"absolute inset-y-0 right-0 pr-3 flex items-center",onClick:D,children:w?e.jsx(Z,{className:"h-4 w-4 text-gray-400"}):e.jsx(_,{className:"h-4 w-4 text-gray-400"})})]}),e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:a.password&&!/^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*()_+\-=[\]{};':"\\|,.<>/?]).+$/.test(a.password)?"Password should include uppercase, lowercase, number, and special symbol.":"Minimum 8 characters"})]}),e.jsxs("div",{children:[e.jsxs("label",{className:"form-label flex items-center gap-2",children:[e.jsx(J,{size:14,className:"text-blue-600"}),"Role"]}),e.jsxs("select",{value:a.roleId,onChange:s=>o({...a,roleId:s.target.value}),className:"form-select",required:!0,children:[e.jsx("option",{value:"",children:"Select a role"}),N.map(s=>e.jsxs("option",{value:s.id,children:[s.name," ",s.fullAccess?"(Full Access)":""]},s.id))]}),N.length===0&&e.jsx("p",{className:"text-xs text-amber-600 mt-1",children:"No roles available. Please create roles in Settings first."})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx("button",{type:"button",onClick:u,className:"btn btn-secondary",children:"Cancel"}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:n?"Update Employee":"Create Employee"})]})]})]})})]})};export{Y as default};
//# sourceMappingURL=Employees-CTQLKf5P.js.map
