import{aj as w,B as a}from"./index-CPERY6Kl.js";const b="",g=w.create({baseURL:`${b}/api/mautic`,headers:{"Content-Type":"application/json"},timeout:12e4});g.interceptors.request.use(t=>{const s=localStorage.getItem("token");return s&&(t.headers.Authorization=`Bearer ${s}`),t});const k=()=>g.get("/clients"),F=t=>g.post("/clients",t),I=(t,s)=>g.put(`/clients/${t}`,s),M=t=>g.patch(`/clients/${t}/toggle`),D=t=>g.delete(`/clients/${t}/permanent`),L=t=>g.post("/clients/test-connection",t),A=(t=null)=>g.get("/dashboard",{params:{clientId:t}}),$=(t={})=>g.get("/contacts",{params:t}),v=(t={})=>g.get("/emails",{params:t}),P=t=>g.get("/segments",{params:{clientId:t}}),T=({clientId:t,page:s=1,limit:e=50})=>g.get("/campaigns",{params:{clientId:t,page:s,limit:e}}),R=()=>g.post("/sync/all"),U=t=>g.post(`/sync/${t}`);class x{async getClients(){try{return{success:!0,data:(await k()).data.data,error:null}}catch(s){return console.error("Error fetching clients:",s),{success:!1,data:null,error:s.response?.data?.message||s.message||"Failed to fetch clients"}}}async createClient(s){try{const e=await F(s);return{success:!0,data:e.data.data,message:e.data.message,error:null}}catch(e){return console.error("Error creating client:",e),{success:!1,data:null,error:e.response?.data?.message||e.message||"Failed to create client"}}}async updateClient(s,e){try{const o=await I(s,e);return{success:!0,data:o.data.data,message:o.data.message,error:null}}catch(o){return console.error("Error updating client:",o),{success:!1,data:null,error:o.response?.data?.message||o.message||"Failed to update client"}}}async deleteClient(s){try{return{success:!0,message:(await M(s)).data.message,error:null}}catch(e){return console.error("Error deleting client:",e),{success:!1,error:e.response?.data?.message||e.message||"Failed to delete client"}}}async hardDeleteClient(s){try{return{success:!0,message:(await D(s)).data.message,error:null}}catch(e){return console.error("Error permanently deleting client:",e),{success:!1,error:e.response?.data?.message||e.message||"Failed to permanently delete client"}}}async testConnection(s){try{const e=await L(s);return{success:e.data.success,message:e.data.message,error:null}}catch(e){return console.error("Error testing connection:",e),{success:!1,message:e.response?.data?.message||e.message||"Connection test failed",error:e.response?.data?.message||e.message}}}async getDashboardMetrics(s=null){try{return{success:!0,data:(await A(s)).data.data,error:null}}catch(e){return console.error("Error fetching dashboard metrics:",e),{success:!1,data:null,error:e.response?.data?.message||e.message||"Failed to fetch dashboard metrics"}}}async getContacts(s={}){try{return{success:!0,data:(await $(s)).data.data,error:null}}catch(e){return console.error("Error fetching contacts:",e),{success:!1,data:null,error:e.response?.data?.message||e.message||"Failed to fetch contacts"}}}async getEmails(s={}){try{return{success:!0,data:(await v(s)).data.data,error:null}}catch(e){return console.error("Error fetching emails:",e),{success:!1,data:null,error:e.response?.data?.message||e.message||"Failed to fetch emails"}}}async getSegments(s=null){try{return{success:!0,data:(await P(s)).data.data,error:null}}catch(e){return console.error("Error fetching segments:",e),{success:!1,data:null,error:e.response?.data?.message||e.message||"Failed to fetch segments"}}}async getCampaigns(s={}){try{const e=await T(s);return{success:!0,data:e.data.data.campaigns,pagination:e.data.data.pagination,error:null}}catch(e){return console.error("Error fetching campaigns:",e),{success:!1,data:null,pagination:null,error:e.response?.data?.message||e.message||"Failed to fetch campaigns"}}}async syncAllClients(){try{const s=await R();return{success:s.data.success,data:s.data.results,message:s.data.message,error:null}}catch(s){return console.error("Error syncing all clients:",s),s.response?.status===409?{success:!1,data:null,isSyncing:!0,message:s.response?.data?.message||"Sync already in progress",error:s.response?.data?.message||"Sync already in progress"}:{success:!1,data:null,error:s.response?.data?.message||s.message||"Failed to sync clients"}}}async syncClient(s){try{const e=await U(s);return{success:e.data.success,data:e.data.data,message:e.data.message,error:null}}catch(e){return console.error("Error syncing client:",e),e.response?.status===409?{success:!1,data:null,isSyncing:!0,message:e.response?.data?.message||"Sync already in progress",error:e.response?.data?.message||"Sync already in progress"}:{success:!1,data:null,error:e.response?.data?.message||e.message||"Failed to sync client"}}}async getSyncStatus(){try{return{success:!0,data:(await g.get("/sync/status")).data.data,error:null}}catch(s){return console.error("Error fetching sync status:",s),{success:!1,data:{isSyncing:!1},error:s.response?.data?.message||s.message||"Failed to fetch sync status"}}}}const m=new x;function N(t=null){const[s,e]=a.useState(null),[o,d]=a.useState(!0),[l,r]=a.useState(null),u=a.useCallback(async()=>{d(!0),r(null);const i=await m.getDashboardMetrics(t);i.success?e(i.data):r(i.error),d(!1)},[t]);return a.useEffect(()=>{u()},[u]),{metrics:s,loading:o,error:l,refetch:u}}function O(){const[t,s]=a.useState([]),[e,o]=a.useState(!0),[d,l]=a.useState(null),r=a.useCallback(async()=>{o(!0),l(null);const u=await m.getClients();u.success?s(u.data):l(u.error),o(!1)},[]);return a.useEffect(()=>{r()},[r]),{clients:t,loading:e,error:d,refetch:r}}function j(){const[t,s]=a.useState(!1),[e,o]=a.useState(!1),[d,l]=a.useState(!1),[r,u]=a.useState(!1),[i,n]=a.useState(null),c=a.useCallback(async y=>{s(!0),n(null);const p=await m.createClient(y);return s(!1),p},[]),f=a.useCallback(async(y,p)=>{o(!0),n(null);const E=await m.updateClient(y,p);return o(!1),E},[]),C=a.useCallback(async y=>{l(!0),n(null);const p=await m.deleteClient(y);return l(!1),p},[]),h=a.useCallback(async y=>{l(!0),n(null);const p=await m.hardDeleteClient(y);return l(!1),p},[]),S=a.useCallback(async y=>{u(!0),n(null);const p=await m.testConnection(y);return u(!1),p},[]);return{createClient:c,updateClient:f,deleteClient:C,hardDeleteClient:h,testConnection:S,isCreating:t,isUpdating:e,isDeleting:d,isTesting:r,error:i}}function B(t={}){const[s,e]=a.useState([]),[o,d]=a.useState(null),[l,r]=a.useState(!0),[u,i]=a.useState(null),n=a.useCallback(async()=>{r(!0),i(null);const c=await m.getEmails(t);c.success?(e(c.data.emails),d(c.data.pagination)):i(c.error),r(!1)},[JSON.stringify(t)]);return a.useEffect(()=>{n()},[n]),{emails:s,pagination:o,loading:l,error:u,refetch:n}}function q(t={}){const[s,e]=a.useState([]),[o,d]=a.useState(null),[l,r]=a.useState(!0),[u,i]=a.useState(null),n=a.useCallback(async()=>{r(!0),i(null);const c=await m.getSegments(t.clientId);if(c.success){e(c.data);const f=c.data.length,C=t.page||1,h=t.limit||20,S=(C-1)*h,y=S+h;e(c.data.slice(S,y)),d({page:C,limit:h,total:f,totalPages:Math.ceil(f/h)})}else i(c.error);r(!1)},[JSON.stringify(t)]);return a.useEffect(()=>{n()},[n]),{segments:s,pagination:o,loading:l,error:u,refetch:n}}function z(t={}){const[s,e]=a.useState([]),[o,d]=a.useState(null),[l,r]=a.useState(!0),[u,i]=a.useState(null),n=a.useCallback(async()=>{r(!0),i(null);const c=await m.getCampaigns({clientId:t.clientId,page:t.page||1,limit:t.limit||20});c.success?(e(c.data),d(c.pagination)):i(c.error),r(!1)},[JSON.stringify(t)]);return a.useEffect(()=>{n()},[n]),{campaigns:s,pagination:o,loading:l,error:u,refetch:n}}function G(){const[t,s]=a.useState(!1),[e,o]=a.useState(null),[d,l]=a.useState(!1),r=a.useRef(!1);a.useEffect(()=>{const n=async()=>{try{const f=await m.getSyncStatus();f.success&&f.data.isSyncing?(s(!0),r.current=!0):r.current&&!f.data.isSyncing&&(s(!1),r.current=!1)}catch(f){console.error("Failed to check sync status:",f)}};n();const c=setInterval(()=>{(t||r.current)&&n()},3e3);return()=>{clearInterval(c),r.current=!1}},[t]);const u=a.useCallback(async()=>{try{s(!0),r.current=!0,o(null),l(!1);const n=await m.syncAllClients();return n.success?l(!0):o(n.error||"Sync failed"),n}catch(n){const c=n.message||"Failed to sync";return o(c),{success:!1,error:c}}finally{r.current&&setTimeout(()=>{s(!1),r.current=!1},500)}},[]),i=a.useCallback(async n=>{try{s(!0),r.current=!0,o(null),l(!1);const c=await m.syncClient(n);return c.success?l(!0):o(c.error||"Sync failed"),c}catch(c){const f=c.message||"Failed to sync";return o(f),{success:!1,error:f}}finally{r.current&&setTimeout(()=>{s(!1),r.current=!1},500)}},[]);return{syncAllClients:u,syncClient:i,isSyncing:t,error:e,success:d}}export{O as a,G as b,z as c,B as d,q as e,N as f,j as u};
//# sourceMappingURL=useMautic-CVm8zvix.js.map
