import{c as ye,ah as Te,ak as e,ar as Me,aq as Ke,B as a,al as Qe,aO as Le,am as Ue,ao as Ce,aB as re,an as Be,ap as ee,aF as Ee,aj as Y,aW as Fe,aA as Ye,aU as Ze}from"./index-CPERY6Kl.js";import{e as et,E as Oe,f as ze,p as _e,L as tt}from"./helpers-DVpO63iy.js";import{a as Ve,b as qe,u as He,f as Ae}from"./helpers-CK_3Qtj6.js";import{C as st}from"./circle-x-Dmi7WjWk.js";import{u as je}from"./useViewLevel-Cd5zze0o.js";import{C as ke}from"./calendar-a85ssUeG.js";import{u as at}from"./permissions-C8EIoUeu.js";const rt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m12 8-4 4 4 4",key:"15vm53"}],["path",{d:"M16 12H8",key:"1fr5h0"}]],$e=ye("circle-arrow-left",rt);const nt=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m12 16 4-4-4-4",key:"1i9zcv"}],["path",{d:"M8 12h8",key:"1wcyev"}]],lt=ye("circle-arrow-right",nt);const it=[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]],ct=ye("dollar-sign",it);const ot=[["path",{d:"M10.1 13.9a14 14 0 0 0 3.732 2.668 1 1 0 0 0 1.213-.303l.355-.465A2 2 0 0 1 17 15h3a2 2 0 0 1 2 2v3a2 2 0 0 1-2 2 18 18 0 0 1-12.728-5.272",key:"1wngk7"}],["path",{d:"M22 2 2 22",key:"y4kqgn"}],["path",{d:"M4.76 13.582A18 18 0 0 1 2 4a2 2 0 0 1 2-2h3a2 2 0 0 1 2 2v3a2 2 0 0 1-.8 1.6l-.468.351a1 1 0 0 0-.292 1.233 14 14 0 0 0 .244.473",key:"10hv5p"}]],dt=ye("phone-off",ot);const mt=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}],["path",{d:"M12 17h.01",key:"p32p05"}]],xt=ye("shield-question-mark",mt),be=({title:o,value:n,subtitle:f,icon:P,color:E="blue",clickable:b=!1,onClick:U})=>{const C={blue:{text:"text-blue-600",bg:"bg-blue-50",border:"border-blue-100"},green:{text:"text-green-600",bg:"bg-green-50",border:"border-green-100"},red:{text:"text-red-600",bg:"bg-red-50",border:"border-red-100"},purple:{text:"text-purple-600",bg:"bg-purple-50",border:"border-purple-100"},orange:{text:"text-orange-600",bg:"bg-orange-50",border:"border-orange-100"}}[E];return e.jsx("div",{className:`bg-white rounded-xl border border-gray-200/60 p-2 transition-all duration-300 inline-flex flex-col 
      ${b?"cursor-pointer hover:shadow-md hover:border-blue-300 active:scale-[0.98]":"hover:shadow-sm"}
      `,onClick:b?U:void 0,children:e.jsxs("div",{className:"flex items-start justify-between gap-2 mb-1",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-xs font-semibold text-gray-500 uppercase tracking-wide",children:o}),e.jsx("h3",{className:"text-xl font-bold text-gray-900 mb-1",children:n}),f&&e.jsx("p",{className:"text-xs text-gray-500 font-medium",children:f})]}),P&&e.jsx("div",{className:`p-2 rounded-lg ${C.bg} ${C.border} border`,children:e.jsx(P,{size:16,className:C.text,strokeWidth:2.5})})]})})},Ge=({metrics:o,onMetricClick:n,viewLevel:f})=>{const{user:P}=Te(),E=P&&P.role==="superadmin";if(!o||!o.overall)return e.jsx("div",{className:"flex gap-4 overflow-x-auto py-1",children:[...Array(5)].map(($,g)=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/60 p-5 animate-pulse min-w-[220px] flex-shrink-0",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-7 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-1/3"})]},g))});const{overall:b}=o,U=b.averageSuccessRate||0,D=b.totalSent>0?b.failedSends/b.totalSent*100:0,C=b.totalSent>0?b.otherStatus/b.totalSent*100:0;return e.jsxs("div",{className:`grid ${E?"grid-cols-5":"grid-cols-4"} gap-4 overflow-x-auto py-1`,children:[e.jsx(be,{title:"Total VoiceMails Sent",value:b.totalSent.toLocaleString(),subtitle:`${b.totalSent} Ringless voicemails`,icon:Me,color:"blue",clickable:f==="campaign",onClick:()=>f==="campaign"&&n("all")}),e.jsx(be,{title:"Successful Deliveries",value:b.successfulDeliveries.toLocaleString(),subtitle:`${U.toFixed(1)}% delivery rate`,icon:Ke,color:"green",clickable:f==="campaign",onClick:()=>f==="campaign"&&n("success")}),e.jsx(be,{title:"Failed Deliveries",value:b.failedSends.toLocaleString(),subtitle:`${D.toFixed(1)}% failure rate`,icon:st,color:"red",clickable:f==="campaign",onClick:()=>f==="campaign"&&n("failure")}),e.jsx(be,{title:"Other Status",value:b.otherStatus?.toLocaleString()||"0",subtitle:`${C.toFixed(1)}% other status`,icon:xt,color:"orange",clickable:f==="campaign",onClick:()=>f==="campaign"&&n("other")}),E&&e.jsx(be,{title:"Total Campaign Cost",value:`$${(b.totalCost||0).toFixed(2)}`,subtitle:`$${(b.totalCost/b.totalSent||0).toFixed(4)} per voicemail`,icon:ct,color:"purple"})]})},gt=()=>{const[o,n]=a.useState([]),[f,P]=a.useState(0),[E,b]=a.useState(!1),{dropcowboy:U,setDCViewLevel:D,setDCSelectedClient:C,setDCSelectedCampaign:$}=je(),{viewLevel:g,selectedClient:u,selectedCampaign:A,campaigns:_}=U,V=(r,c)=>r.reduce((y,L)=>{const z=c(L);return y[z]||(y[z]=[]),y[z].push(L),y},{}),X=a.useRef(null),J=a.useRef(0),H=a.useRef(!1),[K,S]=a.useState(!0),[R,I]=a.useState("all"),[v,M]=a.useState({startDate:"",endDate:""}),[T,B]=a.useState({startDate:"",endDate:""}),[Q,te]=a.useState(!1),[h,l]=a.useState(""),[i,m]=a.useState([]),[d,p]=a.useState(1),[w]=a.useState(50),[N,O]=a.useState([]),[G,de]=a.useState(1),ge=({compact:r=!1})=>e.jsxs("tr",{className:"opacity-100 animate-pulse",children:[e.jsx("td",{className:"sticky left-0 bg-white px-3 py-3 border-r border-gray-200 z-10",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-32"})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-24"})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-20"})}),e.jsx("td",{className:"px-3 py-3 whitespace-nowrap",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-16"})}),e.jsx("td",{className:"px-3 py-3",children:e.jsx("div",{className:"h-3 bg-gray-200 rounded w-28"})})]});a.useEffect(()=>{if(_&&_.length>0){const r=_.flatMap(y=>{const L=y.client||"Unknown",z=y.campaignName||"";return y.records.map(Z=>({...Z,client:L,campaign:z.trim(),status:Z.status?.trim()?.toLowerCase()||"other"}))}),c=u?r.filter(y=>y.client===u):r;m(c),P(c.length)}},[_]),a.useEffect(()=>{const r=(d-1)*w;n(i.slice(r,r+w))},[i,d,w]),a.useEffect(()=>{const r=X.current;S(!1);const c=setTimeout(()=>{if(S(!0),r)try{if(H.current){const y=Math.max(0,r.scrollHeight-r.clientHeight);r.scrollTop=Math.round(J.current*y)}else r.scrollTo({top:0,behavior:"smooth"})}catch{}},60);return()=>clearTimeout(c)},[d]);const pe=o,Ie=r=>{const c=r?.toLowerCase()||"";return["sent","success","delivered"].includes(c)?e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-green-100 text-green-800",children:"Delivered"}):["failed","failure","error"].includes(c)?e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-red-100 text-red-800",children:"Failed"}):e.jsx("span",{className:"px-2 py-1 text-xs font-medium rounded-full bg-gray-100 text-gray-800",children:r||"Unknown"})},[ue,Ne]=a.useState(""),[ve,he]=a.useState(!1),fe=()=>{const r=parseInt(ue,10);if(Number.isNaN(r))return;if(r<1||r>G){he(!0);return}const c=r;p(ue),Ne(""),he(!1);try{window.localStorage.setItem("dc_records_page",String(c))}catch{}};a.useEffect(()=>{ve&&he(!1)},[ue]),a.useEffect(()=>{p(1)},[A]);const ne=a.useMemo(()=>{let r=i;return g==="client"&&u?r=r.filter(c=>c.client===u):g==="campaign"&&u&&A&&(r=r.filter(c=>c.client===u&&c.campaignName===A)),(T.startDate||T.endDate)&&(r=r.filter(c=>{const y=new Date(c.date);return!(T.startDate&&y<new Date(T.startDate)||T.endDate&&y>new Date(T.endDate))})),r},[i,g,u,A,T]),le=a.useMemo(()=>{let r=ne;return R!=="all"&&(R==="other"?r=r.filter(c=>!["success","failure"].includes(c.status)):r=r.filter(c=>c.status===R)),r},[ne,R]),De=a.useMemo(()=>{const r=ne.length,c=ne.filter(z=>z.status==="success").length,y=ne.filter(z=>z.status==="failure").length,L=ne.filter(z=>!["success","failure"].includes(z.status)).length;return{overall:{totalSent:r,successfulDeliveries:c,failedSends:y,otherStatus:L,averageSuccessRate:r>0?c/r*100:0}}},[ne]);return a.useEffect(()=>{if(!u||!A||i.length===0)return;const r=le.filter(L=>L.client===u&&L.campaignName===A),c=(d-1)*w,y=c+w;O(r.slice(c,y)),de(Math.ceil(r.length/w))},[u,A,d,le]),e.jsxs("div",{className:"bg-white rounded-xl shadow-sm border border-gray-200",children:[e.jsxs("div",{className:"px-6 py-5 border-b border-gray-200 bg-gradient-to-r from-gray-50 to-white",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-900",children:"Voicemail Campaign Records"}),e.jsx("button",{onClick:async()=>{try{te(!0),l("Refreshing data..."),l("Data refreshed successfully")}catch(r){l("Error: "+(r.message||"unknown"))}finally{te(!1),setTimeout(()=>l(""),3e3)}},disabled:Q,className:"inline-flex items-center gap-2 px-4 py-2 text-sm font-medium rounded-lg text-white bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:text-gray-500 disabled:cursor-not-allowed transition-colors shadow-sm",children:Q?e.jsx(Qe,{className:"animate-spin",size:16}):"Refresh Data"})]}),g!=="root"&&e.jsxs("div",{className:"flex items-center gap-3 flex-wrap",children:[e.jsx("input",{type:"date",value:v.startDate,onChange:r=>M(c=>({...c,startDate:r.target.value})),className:"px-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500","aria-label":"Start date",title:"From date"}),e.jsx("span",{className:"text-sm text-gray-500 font-medium",children:"to"}),e.jsx("input",{type:"date",value:v.endDate,onChange:r=>M(c=>({...c,endDate:r.target.value})),className:"px-3 py-2.5 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-blue-500 focus:border-blue-500","aria-label":"End date",title:"To date"}),e.jsx("button",{onClick:()=>B({startDate:v.startDate,endDate:v.endDate}),className:"px-3 py-2.5 text-sm font-semibold bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors",title:"Apply date filter",children:"Save"}),e.jsx("button",{onClick:()=>{M({startDate:"",endDate:""}),B({startDate:"",endDate:""})},className:"px-3 py-2.5 text-sm font-medium text-gray-700 bg-gray-100 rounded-lg hover:bg-gray-200 transition-colors",title:"Clear date filter",children:"Clear"})]})]}),e.jsx(Ge,{metrics:De,onMetricClick:r=>{g==="campaign"&&(I(r),p(1))},viewLevel:g}),e.jsxs("div",{className:"overflow-x-auto overflow-y-auto relative",ref:X,children:[e.jsxs("div",{className:"overflow-x-auto rounded-xl border border-gray-200 shadow-sm bg-white",children:[e.jsx("div",{className:"flex items-center justify-between px-4 py-3 border-b border-gray-200 bg-gray-50",children:e.jsxs("div",{className:"flex items-center gap-2 text-sm font-medium text-gray-600",children:[g==="root"&&e.jsx("span",{children:"ðŸ“Š All Clients"}),g==="client"&&e.jsx(e.Fragment,{children:e.jsxs("span",{children:["Client: ",u]})}),g==="campaign"&&e.jsxs(e.Fragment,{children:[e.jsx("button",{onClick:()=>{D("client"),$(null)},className:"text-blue-600 hover:underline",children:"â† Back"}),e.jsxs("span",{children:["/ Campaign: ",A]})]})]})}),e.jsx("div",{className:"max-h-[500px] overflow-y-auto",children:e.jsxs("table",{className:"w-full min-w-max border-collapse",children:[e.jsxs("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100 border-b-2 border-gray-300 sticky top-0 z-30",children:[g==="root"&&e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Client"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Total Campaigns"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Total Voicemails sent"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Success"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Failure"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Other"})]}),g==="client"&&e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Campaign"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Total Voicemails sent"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Success"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Failure"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Other"})]}),g==="campaign"&&e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Phone"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Date"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"First Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Last Name"}),e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold uppercase text-gray-700",children:"Email"})]})]}),e.jsx("tbody",{className:"divide-y divide-gray-100 text-sm text-gray-700",children:(()=>{if(Q||E)return[...Array(w)].map((r,c)=>e.jsx(ge,{},c));if(!pe?.length)return e.jsx("tr",{children:e.jsx("td",{colSpan:"6",className:"py-16 text-center text-gray-400 text-sm",children:"ðŸ“­ No records found"})});if(g==="root"){const r=V(i,c=>c.client&&c.client.trim()||"Unknown Client");return Object.entries(r).map(([c,y])=>{const L=y.length,z=y.filter(q=>q.status?.toLowerCase()==="success").length,Z=y.filter(q=>q.status?.toLowerCase()==="failure").length,oe=y.filter(q=>!["success","failure"].includes(q.status)).length;return e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer transition-all",onClick:()=>{C(c),D("client")},children:[e.jsx("td",{className:"px-4 py-3 font-semibold text-gray-800",children:c}),e.jsx("td",{className:"px-4 py-3",children:new Set(y.map(q=>q.campaignId)).size}),e.jsx("td",{className:"px-4 py-3",children:L}),e.jsx("td",{className:"px-4 py-3",children:z}),e.jsx("td",{className:"px-4 py-3",children:Z}),e.jsx("td",{className:"px-4 py-3",children:oe})]},c)})}if(g==="client"&&u){const r=V(le,c=>c.campaignName||"Unknown Campaign");return Object.entries(r).map(([c,y])=>{const L=y.length,z=y.filter(q=>q.status?.toLowerCase()==="success").length,Z=y.filter(q=>q.status?.toLowerCase()==="failure").length,oe=y.filter(q=>!["success","failure"].includes(q.status)).length;return e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer transition-all",onClick:()=>{$(c),D("campaign")},children:[e.jsx("td",{className:"px-4 py-3 font-medium",children:c}),e.jsx("td",{className:"px-4 py-3",children:L}),e.jsx("td",{className:"px-4 py-3",children:z}),e.jsx("td",{className:"px-4 py-3",children:Z}),e.jsx("td",{className:"px-4 py-3",children:oe})]},c)})}if(g==="campaign"&&A){const r=Math.ceil(le.length/w),c=Math.min(d,r||1);return c!==d&&p(c),le.slice((c-1)*w,c*w).map((L,z)=>e.jsxs("tr",{className:"hover:bg-blue-50 cursor-pointer transition-all",children:[e.jsx("td",{className:"px-4 py-3",children:L.phoneNumber}),e.jsx("td",{className:"px-4 py-3",children:Ie(L.status)}),e.jsx("td",{className:"px-4 py-3",children:new Date(L.date).toLocaleDateString("en-US",{month:"short",day:"numeric",year:"numeric"})}),e.jsx("td",{className:"px-4 py-3",children:L.firstName}),e.jsx("td",{className:"px-4 py-3",children:L.lastName}),e.jsx("td",{className:"px-4 py-3",children:L.email})]},z))}})()})]})})]}),g==="campaign"&&N.length>0&&e.jsxs("div",{className:"sticky bottom-0 left-0 right-0 bg-gradient-to-r from-gray-50 to-white backdrop-blur-sm border-t-2 border-gray-200 px-6 py-4 flex items-center justify-between z-10 shadow-lg",children:[e.jsxs("div",{className:"text-sm text-gray-700 font-medium",children:["Showing"," ",e.jsx("span",{className:"font-bold text-blue-600",children:(d-1)*w+1})," ","to"," ",e.jsx("span",{className:"font-bold text-blue-600",children:Math.min(d*w,le.length)})," ","of"," ",e.jsx("span",{className:"font-bold text-blue-600",children:le.length})," ","records"]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>p(1),disabled:d===1,className:"px-3 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 disabled:opacity-40 disabled:cursor-not-allowed transition-all shadow-sm",title:"First Page",children:"Â«Â«"}),e.jsx("button",{onClick:()=>p(Math.max(1,d-1)),disabled:d===1,className:"px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 disabled:opacity-40 disabled:cursor-not-allowed transition-all shadow-sm",children:"Previous"}),e.jsxs("div",{className:"px-4 py-2 text-sm font-bold text-gray-900 bg-blue-50 border border-blue-200 rounded-lg",title:`Total pages: ${G}`,children:["Page ",d," of ",G]}),e.jsx("button",{onClick:()=>p(Math.min(G,d+1)),disabled:d===G,className:"px-4 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 disabled:opacity-40 disabled:cursor-not-allowed transition-all shadow-sm",children:"Next"}),e.jsx("button",{onClick:()=>p(G),disabled:d===G,className:"px-3 py-2 text-sm font-semibold text-gray-700 bg-white border border-gray-300 rounded-lg hover:bg-blue-50 disabled:opacity-40 disabled:cursor-not-allowed transition-all shadow-sm",title:"Last Page",children:"Â»Â»"}),e.jsxs("div",{className:"flex items-center gap-2 ml-3 pl-3 border-l-2 border-gray-300",children:[e.jsx("span",{className:"text-xs text-gray-600 font-medium",children:"Jump to:"}),e.jsx("input",{type:"number",min:"1",max:G,value:ue,onChange:r=>Ne(r.target.value),onKeyDown:r=>{r.key==="Enter"&&fe()},placeholder:"Page #",className:`w-20 px-3 py-2 rounded-lg text-sm font-medium border focus:ring-2 focus:ring-blue-500 ${ve?"border-red-500 ring-1 ring-red-300":"border-gray-300"}`}),e.jsx("button",{onClick:fe,className:"px-4 py-2 text-sm font-semibold bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors shadow-sm",children:"Go"})]})]})]})]})]})};function ut({clientCampaigns:o=null,clientName:n=null}){const[f,P]=a.useState(n||"All"),[E,b]=a.useState(["All"]),U=o?{campaignIds:o}:{},{metrics:D,error:C,refetch:$}=Ve(U),{syncLogs:g,refetch:u}=qe(10),{triggerFetch:A,isFetching:_,error:V}=He(),{dropcowboy:X,setDCCampaigns:J,setDCSelectedClient:H,setDCMetrics:K}=je(),{savedMetrics:S}=X;a.useEffect(()=>{if(D?.campaigns){const v=et(D.campaigns);b(["All",...v]),n&&v.includes(n)&&P(n)}const I=n&&D?.campaigns?D.campaigns.filter(v=>v.client===n):D?.campaigns;J(I),K(D),H(n)},[D,n]),a.useEffect(()=>{const I=setInterval(()=>{$(),u()},3e6);return()=>clearInterval(I)},[$,u]);const R=async()=>{re.info("Starting SFTP sync... This may take 30-60 seconds.",{autoClose:3e3});const I=await A();I.success?(await $(),await u(),I.data?.warning?re.warning(I.data.warning,{autoClose:5e3}):I.data?.filesDownloaded>0?re.success(`Successfully fetched ${I.data.filesDownloaded} files from SFTP!`,{autoClose:5e3}):re.info("Sync completed - using existing data.",{autoClose:3e3})):re.error("Failed to fetch data: "+(I.error||"Unknown error"),{autoClose:5e3})};return e.jsx(Oe,{children:e.jsxs("div",{className:"py-6 sm:py-8",children:[(C||V)&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start",children:[e.jsx(Le,{className:"text-red-600 mr-3 flex-shrink-0 mt-0.5",size:18}),e.jsx("p",{className:"text-sm text-red-800 leading-relaxed",children:C||V})]}),e.jsxs("div",{className:"mb-6 flex items-center justify-between gap-4 bg-white p-3 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-4",children:g.length>0&&g[0]&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Last sync: ",ze(_e(g[0].timestamp),"MMM dd, h:mm a")]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:R,disabled:_,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:[e.jsx(Ue,{className:`w-2 h-2 ${_?"animate-spin":""}`}),_?"Fetching...":"Fetch from SFTP"]})})]}),S?.length===0?e.jsx("div",{className:"flex items-center justify-center h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ce,{className:"animate-spin mx-auto mb-4 text-blue-600",size:40}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Loading dashboard..."})]})}):e.jsx("div",{className:"space-y-6",children:e.jsx(gt,{})})]})})}const pt=({campaigns:o,selectedCampaign:n,setSelectedCampaign:f,goBackToCampaigns:P})=>{const[E,b]=a.useState(""),[U,D]=a.useState(""),[C,$]=a.useState(""),[g,u]=a.useState(""),[A,_]=a.useState([]),[V,X]=a.useState(!1),[J,H]=a.useState(new Map),K=a.useRef(null),S=a.useRef(null),R=(l,i,m)=>{const d=J.get(String(l));if(d&&typeof d.sentCount=="number"){const p=i==="dateSent"?d.sentCount:d.readCount;return new Array(p).fill(null)}if(C||g)return[]},I=l=>{if(l?.current){if(typeof l.current.showPicker=="function")try{l.current.showPicker()}catch(i){console.debug(i)}typeof l.current.focus=="function"&&l.current.focus()}};a.useEffect(()=>{if(!n?.clientId)return;(async()=>{X(!0);try{const i=new URLSearchParams;C&&i.append("fromDate",C),g&&i.append("toDate",g);const p=(await Y.get(`/api/mautic/clients/${n.clientId}/email-reports?${i}`)).data.data||[],w=p.length>0,N=new Map;if(w)for(const O of p)N.set(String(O.eId),{sentCount:O.sentCount||0,readCount:O.readCount||0});_(p),H(N)}catch(i){console.error("Error fetching email data:",i),_([])}finally{X(!1)}})()},[n?.clientId,C,g]);const[v,M]=a.useState(!1);a.useEffect(()=>{!V&&!v&&M(!0)},[V]);const T=()=>{if(!n)return{campaignSent:0,campaignRead:0,readPercentage:0};if(C||g){const d=O=>{const de=R(O.mauticEmailId,"dateSent").length,pe=R(O.mauticEmailId,"dateRead").length;return{sent:de,read:pe}};let p=0,w=0;n.emails.forEach(O=>{const{sent:G,read:de}=d(O);p+=G,w+=de});const N=p?(w/p*100).toFixed(2):0;return{campaignSent:p,campaignRead:w,readPercentage:N}}const l=n.emails.reduce((d,p)=>d+(p.sentCount||0),0),i=n.emails.reduce((d,p)=>d+(p.readCount||0),0),m=l?(i/l*100).toFixed(2):0;return{campaignSent:l,campaignRead:i,readPercentage:m}},B=a.useMemo(()=>T(),[n,A,J,C,g]),Q=l=>{if(C||g){const p=R(l.mauticEmailId,"dateSent").length,w=R(l.mauticEmailId,"dateRead").length,N=p?(w/p*100).toFixed(2):0;return{sent:p,read:w,readRate:N}}const i=l.sentCount||0,m=l.readCount||0,d=i?(m/i*100).toFixed(2):0;return{sent:i,read:m,readRate:d}},te=l=>{const i=o.findIndex(m=>m.id===n?.id);l==="next"&&i<o.length-1?f(o[i+1]):l==="prev"&&i>0&&f(o[i-1])},h=n?.segments?.filter(l=>{if(!C&&!g)return!0;if(!l.dateAdded)return!1;const i=new Date(l.dateAdded);if(C){const m=new Date(C);if(m.setHours(0,0,0,0),i<m)return!1}if(g){const m=new Date(g);if(m.setHours(23,59,59,999),i>m)return!1}return!0});return e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("button",{onClick:P,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 transition-colors",children:[e.jsx($e,{className:"w-6 h-6"}),e.jsx("span",{className:"font-medium",children:"Back to Campaigns"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>te("prev"),disabled:o.findIndex(l=>l.id===n?.id)===0,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Previous Campaign",children:e.jsx($e,{className:"w-5 h-5"})}),e.jsx("button",{onClick:()=>te("next"),disabled:o.findIndex(l=>l.id===n?.id)===o.length-1,className:"p-2 rounded-lg border border-gray-300 hover:bg-gray-50 disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Next Campaign",children:e.jsx(lt,{className:"w-5 h-5"})})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-2",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n?.name}),!n?.isPublished&&e.jsx("span",{className:"px-3 py-1 text-sm rounded-full bg-gray-200 text-gray-600",children:"Unpublished"})]}),n?.description&&e.jsx("p",{className:"text-gray-500 mt-2",children:n?.description})]}),e.jsx("div",{className:"rounded-xl shadow-md p-5 mb-6 bg-gradient-to-br from-green-50 to-green-100 border border-green-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-end gap-3",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1",children:"From Date"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:K,type:"date",value:E,onChange:l=>b(l.target.value),className:"hide-date-icon px-4 py-2 border-2 border-gray-300 rounded-lg text-sm focus:border-green-700 bg-white font-medium text-black"}),e.jsx("button",{type:"button",onClick:()=>I(K),title:"Open date picker",className:"-ml-8 p-2 rounded-md text-gray-600 hover:text-black transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1",children:"To Date"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:S,type:"date",value:U,onChange:l=>D(l.target.value),className:" hide-date-icon px-4 py-2 border-2 border-gray-300 rounded-lg text-sm focus:border-green-700 bg-white font-medium text-black"}),e.jsx("button",{type:"button",onClick:()=>I(S),title:"Open date picker",className:"-ml-8 p-2 rounded-md text-gray-600 hover:text-black transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{$(E),u(U)},className:"px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg text-sm font-semibold hover:from-green-700 hover:to-green-800 shadow-md hover:shadow-lg transition-all",children:"Apply"}),e.jsx("button",{onClick:()=>{b(""),D(""),$(""),u("")},className:"px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg text-sm font-semibold hover:from-gray-700 hover:to-gray-800 shadow-md hover:shadow-lg transition-all",children:"Clear"})]})]})}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-8",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-500 to-primary-700 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-4 h-4 text-white"}),e.jsx("div",{className:"text-sm text-white font-semibold",children:"Total Segments"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:h?.length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary-500 to-secondary-700 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-4 h-4 text-white"}),e.jsx("div",{className:"text-sm text-white font-semibold",children:"Total Emails"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:n?.emails?.length||0})]}),n?.isPublished&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"bg-gradient-to-br from-accent-600 to-accent-800 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-4 h-4 text-white"}),e.jsx("div",{className:"text-sm text-white font-bold uppercase tracking-wide",children:"Emails Sent"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:v?T().campaignSent.toLocaleString():"..."}),e.jsx("div",{className:"text-xs text-white mt-2 font-medium",children:"Total deliveries"})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary-700 to-secondary-900 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ee,{className:"w-4 h-4 text-white"}),e.jsx("div",{className:"text-sm text-white font-bold uppercase tracking-wide",children:"Emails Read"})]}),e.jsx("div",{className:"text-2xl font-bold text-white",children:v?T().campaignRead.toLocaleString():"..."}),e.jsx("div",{className:"text-xs text-white mt-2 font-medium",children:"Total opens"})]})]})]}),n?.isPublished&&e.jsx("div",{className:"mb-8",children:e.jsxs("div",{className:`rounded-2xl p-4 shadow-xl border-2 
                        ${B.readPercentage>75?"bg-green-50 border-green-400":B.readPercentage>50?"bg-yellow-50 border-yellow-400":"bg-red-50 border-red-400"}
                        transition-colors duration-300`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`p-3 rounded-lg shadow-inner
                                    ${B.readPercentage>75?"bg-green-200":B.readPercentage>50?"bg-yellow-200":"bg-red-200"}`,children:e.jsx(Ee,{className:`w-5 h-5 
                                        ${B.readPercentage>75?"text-green-800":B.readPercentage>50?"text-yellow-800":"text-red-800"}`})}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-semibold text-gray-900",children:"Overall Read Rate"}),e.jsx("p",{className:"text-gray-500 text-sm mt-1",children:"Based on all emails in this campaign"})]})]}),e.jsx("div",{className:"text-2xl font-extrabold",children:e.jsxs("span",{className:B.readPercentage>75?"text-green-900":B.readPercentage>50?"text-yellow-900":"text-red-900",children:[B.readPercentage,"%"]})})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-3 overflow-hidden",children:e.jsx("div",{className:`h-3 rounded-full transition-all duration-500
                                ${B.readPercentage>75?"bg-green-500":B.readPercentage>50?"bg-yellow-400":"bg-red-500"}`,style:{width:`${B.readPercentage}%`}})})]})}),n?.emails?.length>0&&n?.isPublished&&e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-900 mb-6 flex items-center gap-2",children:[e.jsx(ee,{className:"w-7 h-7 text-blue-600"}),"Individual Email Performance"]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Email"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-blue-700 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),"Sent"]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-green-700 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Ee,{className:"w-4 h-4"}),"Read"]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-purple-700 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),"Read Rate"]})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:n?.emails?.map((l,i)=>{const m=Q(l);return e.jsxs("tr",{className:`hover:bg-blue-50 transition-colors ${i%2===0?"bg-white":"bg-gray-50"}`,children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(ee,{className:"w-4 h-4 text-gray-400"}),e.jsx("span",{className:"text-sm font-medium text-gray-700 truncate",children:l.name})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm font-semibold text-blue-800",children:v?m.sent.toLocaleString():"..."})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm font-semibold text-green-800",children:v?m.read.toLocaleString():"..."})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex items-center justify-center px-3 py-1 rounded-full text-xs font-bold ${m.readRate>75?"bg-green-100 text-green-800":m.readRate>50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:v?`${m.readRate}%`:"..."})})]},l.id)})}),e.jsx("tfoot",{className:"bg-gradient-to-r from-blue-100 to-purple-100 border-t-2 border-blue-300",children:e.jsxs("tr",{children:[e.jsxs("td",{className:"px-4 py-3 font-bold text-gray-900 text-sm",children:["Total (",n?.emails?.length," Emails)"]}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-lg font-extrabold text-blue-900",children:v?T().campaignSent.toLocaleString():"..."})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-lg font-extrabold text-green-900",children:v?T().campaignRead.toLocaleString():"..."})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:`inline-flex items-center px-3 py-1 rounded font-extrabold text-sm ${T().readPercentage>75?"bg-green-200 text-green-900":T().readPercentage>50?"bg-yellow-200 text-yellow-900":"bg-red-200 text-red-900"}`,children:v?`${T().readPercentage}%`:"..."})})]})})]})})})]})]})},ht=({campaigns:o,selectedClient:n,loadingCampaigns:f,goBackToServices:P,openCampaignDetails:E})=>{const[b,U]=a.useState(""),[D,C]=a.useState(""),[$,g]=a.useState(""),[u,A]=a.useState(""),[_,V]=a.useState([]),[X,J]=a.useState(!1),[H,K]=a.useState(new Map),S=a.useRef(null),R=a.useRef(null),I=(h,l,i)=>{const m=H.get(String(h));if(m&&typeof m.sentCount=="number"){const d=l==="dateSent"?m.sentCount:m.readCount;return new Array(d).fill(null)}if($||u)return[]},v=h=>{if(h?.current){if(typeof h.current.showPicker=="function")try{h.current.showPicker()}catch(l){console.debug(l)}typeof h.current.focus=="function"&&h.current.focus()}};a.useEffect(()=>{if(!n?.id)return;(async()=>{J(!0);try{const l=new URLSearchParams;$&&l.append("fromDate",$),u&&l.append("toDate",u);const d=(await Y.get(`/api/mautic/clients/${n.mauticApiId}/email-reports?${l}`)).data.data||[],p=d.length>0,w=new Map;if(p)for(const N of d)w.set(String(N.eId),{sentCount:N.sentCount||0,readCount:N.readCount||0});V(d),K(w)}catch(l){console.error("Error fetching email reports:",l),V([])}finally{J(!1)}})()},[n?.id,$,u]);const[M,T]=a.useState(!1);a.useEffect(()=>{!X&&!M&&T(!0)},[X]);const B=h=>{if(!Array.isArray(h))return 0;if($||u){let i=0;return h.forEach(m=>{m.emails.forEach(d=>{i+=I(d.mauticEmailId,"dateSent").length})}),i}return h.reduce((i,m)=>i+Q(m),0)},Q=h=>{if(!h)return 0;if($||u){let i=0;return h.emails.forEach(m=>{i+=I(m.mauticEmailId,"dateSent").length}),i}return h.emails.reduce((i,m)=>i+(m.sentCount||0),0)},te=h=>{const l=new Set;return h.forEach(i=>{i.emails.forEach(m=>{l.add(m.mauticEmailId)})}),l.size};return e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("button",{onClick:P,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6",children:[e.jsx(Fe,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Back to ",n?.name," Services"]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Autovation Campaigns"}),e.jsxs("p",{className:"text-gray-500 mt-2",children:["Viewing campaigns for ",e.jsx("span",{className:"font-semibold",children:n?.name})]})]}),f?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"text-gray-500",children:"Loading campaigns..."})}):o.length===0?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx("div",{className:"text-gray-400",children:"No campaigns found."})}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"rounded-xl shadow-md p-5 mb-6 bg-gradient-to-br from-green-50 to-green-100 border border-green-200",children:e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-end gap-3",children:[e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1",children:"From Date"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:S,type:"date",value:b,onChange:h=>U(h.target.value),className:"hide-date-icon px-4 py-2 border-2 border-gray-300 rounded-lg text-sm focus:border-green-700 bg-white font-medium text-black"}),e.jsx("button",{type:"button",onClick:()=>v(S),title:"Open date picker",className:"-ml-8 transparent p-2 rounded-md text-gray-600 hover:text-black transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]})]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("div",{className:"flex flex-col",children:[e.jsx("label",{className:"text-xs font-semibold text-gray-700 mb-1",children:"To Date"}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{ref:R,type:"date",value:D,onChange:h=>C(h.target.value),className:"hide-date-icon px-4 py-2 border-2 border-gray-300 rounded-lg text-sm focus:border-green-700 bg-white font-medium text-black"}),e.jsx("button",{type:"button",onClick:()=>v(R),title:"Open date picker",className:"-ml-8 p-2 rounded-md text-gray-600 hover:text-black transition-colors",children:e.jsx(ke,{className:"w-4 h-4"})})]})]})}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("button",{onClick:()=>{g(b),A(D)},className:"px-4 py-2 bg-gradient-to-r from-green-600 to-green-700 text-white rounded-lg text-sm font-semibold hover:from-green-700 hover:to-green-800 shadow-md hover:shadow-lg transition-all",children:"Apply"}),e.jsx("button",{onClick:()=>{U(""),C(""),g(""),A("")},className:"px-4 py-2 bg-gradient-to-r from-gray-600 to-gray-700 text-white rounded-lg text-sm font-semibold hover:from-gray-700 hover:to-gray-800 shadow-md hover:shadow-lg transition-all",children:"Clear"})]})]})}),e.jsxs("div",{className:"bg-gradient-to-br from-blue-50 to-purple-50 rounded-xl shadow-xl border-2 border-blue-300 overflow-hidden",children:[e.jsx("div",{className:"p-3 bg-gradient-to-r from-primary-600 to-primary-800",children:e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(Ye,{className:"w-4 h-4 text-white"}),e.jsx("h3",{className:"text-xl font-bold text-white",children:"Overall Campaign Summary"})]})}),e.jsx("div",{className:"p-4",children:e.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[e.jsxs("div",{className:"bg-gradient-to-br from-primary-500 to-primary-700 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Ce,{className:"w-3 h-3 text-white"}),e.jsx("div",{className:"text-xs text-white font-bold uppercase",children:"Total Campaigns"})]}),e.jsx("div",{className:"text-2xl font-extrabold text-white",children:o.length})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary-500 to-secondary-700 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(Be,{className:"w-3 h-3 text-white"}),e.jsx("div",{className:"text-xs text-white font-bold uppercase",children:"Total Segments"})]}),e.jsx("div",{className:"text-2xl font-extrabold text-white",children:o[0]?.segments?.length||0})]}),e.jsxs("div",{className:"bg-gradient-to-br from-accent-600 to-accent-800 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-3 h-3 text-white"}),e.jsx("div",{className:"text-xs text-white font-bold uppercase",children:"Total Emails"})]}),e.jsx("div",{className:"text-2xl font-extrabold text-white",children:te(o)})]}),e.jsxs("div",{className:"bg-gradient-to-br from-secondary-700 to-secondary-900 rounded-xl p-3",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsx(ee,{className:"w-3 h-3 text-white"}),e.jsx("div",{className:"text-xs text-white font-bold uppercase",children:"Total Emails Sent"})]}),e.jsx("div",{className:"text-2xl font-extrabold text-white",children:M?B(o).toLocaleString():"..."})]})]})})]}),e.jsx("div",{className:"bg-white rounded-xl shadow-lg border border-gray-200 overflow-hidden mt-8",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gradient-to-r from-gray-50 to-gray-100",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-xs font-bold text-gray-700 uppercase tracking-wider",children:"Campaign Name"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-purple-700 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),"Emails"]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-gray-700 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(ee,{className:"w-4 h-4"}),"Emails Sent"]})}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-bold text-green-700 uppercase tracking-wider",children:e.jsxs("div",{className:"flex items-center justify-center gap-1",children:[e.jsx(Me,{className:"w-4 h-4"}),"Read Rate"]})})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-100",children:o.map((h,l)=>{let i,m;$||u?(i=0,m=0,h.emails.forEach(p=>{i+=I(p.mauticEmailId,"dateSent").length,m+=I(p.mauticEmailId,"dateRead").length})):(i=h.emails.reduce((p,w)=>p+w.sentCount,0),m=h.emails.reduce((p,w)=>p+w.readCount,0));const d=i?(m/i*100).toFixed(2):0;return e.jsxs("tr",{className:`hover:bg-blue-50 transition-colors cursor-pointer ${l%2===0?"bg-white":"bg-gray-50"}`,onClick:()=>E(h),children:[e.jsx("td",{className:"px-4 py-3",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(Ce,{className:"w-4 h-4 text-purple-600"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-semibold text-gray-900 text-sm",children:h.name}),!h.isPublished&&e.jsx("span",{className:"inline-block mt-1 px-2 py-0.5 text-xs font-semibold rounded-full bg-amber-100 text-amber-700",children:"Unpublished"})]})]})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm font-bold text-purple-800",children:h.emails.length})}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsx("span",{className:"text-sm font-bold text-gray-800",children:M?Q(h).toLocaleString():"..."})}),e.jsx("td",{className:"px-4 py-3 text-center",children:h.isPublished?e.jsxs("span",{className:`inline-flex items-center px-2 py-1 rounded text-xs font-bold ${d>75?"bg-green-100 text-green-800":d>50?"bg-yellow-100 text-yellow-800":"bg-red-100 text-red-800"}`,children:[M?d:"...","%"]}):e.jsx("span",{className:"text-gray-400 text-xs",children:"N/A"})})]},h.id)})})]})})})]})]})},ft=({selectedClient:o})=>{const{metrics:n,error:f,refetch:P}=Ve({}),{syncLogs:E,refetch:b}=qe(10),{triggerFetch:U,isFetching:D,error:C}=He(),{dropcowboy:$,setDCCampaigns:g,setDCMetrics:u}=je(),{campaigns:A,savedMetrics:_}=$,[V,X]=a.useState([]);a.useEffect(()=>{g(n?.campaigns),u(n)},[n]);const J=async()=>{re.info("Starting SFTP sync... This may take 30-60 seconds.",{autoClose:3e3});const S=await U();S.success?(await P(),await b(),S.data?.warning?re.warning(S.data.warning,{autoClose:5e3}):S.data?.filesDownloaded>0?re.success(`Successfully fetched ${S.data.filesDownloaded} files from SFTP!`,{autoClose:5e3}):re.info("Sync completed - using existing data.",{autoClose:3e3})):re.error("Failed to fetch data: "+(S.error||"Unknown error"),{autoClose:5e3})};a.useEffect(()=>{if(A&&A.length>0){const S=A.flatMap(R=>{const I=R.client||"Unknown",v=R.campaignName||"";return R.records.map(M=>({...M,client:I,segment:v.trim(),status:M.status?.trim()?.toLowerCase()||"other"}))});X(S)}},[A]);const H=a.useMemo(()=>V.filter(R=>R.client===o.name),[V,o]),K=a.useMemo(()=>{const S=H.length,R=H.filter(M=>M.status==="success").length,I=H.filter(M=>M.status==="failure").length,v=H.filter(M=>!["success","failure"].includes(M.status)).length;return{overall:{totalSent:S,successfulDeliveries:R,failedSends:I,otherStatus:v,averageSuccessRate:S>0?R/S*100:0}}},[H]);return!K||!K.overall?e.jsx("div",{className:"flex gap-4 overflow-x-auto py-1",children:[...Array(5)].map((S,R)=>e.jsxs("div",{className:"bg-white rounded-xl border border-gray-200/60 p-5 animate-pulse min-w-[220px] flex-shrink-0",children:[e.jsx("div",{className:"h-3 bg-gray-200 rounded w-1/2 mb-3"}),e.jsx("div",{className:"h-7 bg-gray-200 rounded w-3/4 mb-2"}),e.jsx("div",{className:"h-2 bg-gray-200 rounded w-1/3"})]},R))}):e.jsxs(Oe,{children:[(f||C)&&e.jsxs("div",{className:"mb-6 bg-red-50 border border-red-200 rounded-lg p-4 flex items-start",children:[e.jsx(Le,{className:"text-red-600 mr-3 flex-shrink-0 mt-0.5",size:18}),e.jsx("p",{className:"text-sm text-red-800 leading-relaxed",children:f||C})]}),e.jsxs("div",{className:"mb-1 flex items-center justify-between gap-4 bg-white py-1 px-2 rounded-lg shadow-sm border border-gray-200",children:[e.jsx("div",{className:"flex items-center gap-4",children:E.length>0&&E[0]&&e.jsxs("div",{className:"text-xs text-gray-500",children:["Last sync: ",ze(_e(E[0].timestamp),"MMM dd, h:mm a")]})}),e.jsx("div",{className:"flex items-center gap-2",children:e.jsxs("button",{onClick:J,disabled:D,className:"flex items-center gap-2 px-3 py-1.5 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:opacity-50 disabled:cursor-not-allowed text-sm",children:[e.jsx(Ue,{className:`w-2 h-2 ${D?"animate-spin":""}`}),D?"Fetching...":"Fetch from SFTP"]})})]}),_?.length===0?e.jsx("div",{className:"flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx(Ce,{className:"animate-spin mx-auto mb-4 text-blue-600",size:40}),e.jsx("p",{className:"text-gray-600 text-sm font-medium",children:"Loading dashboard..."})]})}):e.jsx(Ge,{metrics:K})]})},bt=({selectedClient:o})=>{const n=[{title:"Total Emails",value:Ae(o.totalEmails),icon:ee,color:"bg-indigo-500"},{title:"Total Campaigns",value:Ae(o.totalCampaigns||0),icon:Ze,color:"bg-purple-500"},{title:"Total Segments",value:Ae(o.totalSegments),icon:tt,color:"bg-green-500"}];return e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-2",children:n.map((f,P)=>{const E=f.icon;return e.jsx("div",{className:"bg-white rounded-lg shadow-sm border border-gray-200 p-3 hover:shadow-md transition-shadow",children:e.jsxs("div",{className:"flex items-start justify-between",children:[e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-600 mb-1",children:f.title}),e.jsx("p",{className:"text-xl font-bold text-gray-900",children:f.value})]}),e.jsx("div",{className:`${f.color} p-3 rounded-lg`,children:e.jsx(E,{className:"text-white",size:20})})]})},P)})})},yt=({selectedClient:o,goBackToClients:n,openMauticCampaigns:f,openDropcowboyCampaigns:P})=>{const{selectedService:E,setSelectedService:b}=je();return E===null&&b(o.services[0]||"mautic"),e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("button",{onClick:n,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(Fe,{className:"w-5 h-5"}),e.jsx("span",{className:"font-medium",children:"Back to Clients"})]}),e.jsx("div",{className:"bg-white border-b border-gray-200 sticky z-40",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm font-medium text-gray-500 py-4",children:"Service Stats:"}),e.jsxs("nav",{className:"flex space-x-4","aria-label":"Services",children:[o.services.includes("mautic")?e.jsxs("button",{onClick:()=>b("mautic"),className:`
                  flex items-center gap-2 px-4 py-4 border-b-2 font-medium text-sm transition-colors
                  ${E==="mautic"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx("span",{className:"text-lg"}),e.jsx("span",{children:"Autovation"})]}):e.jsx(e.Fragment,{}),o.services.includes("dropcowboy")?e.jsxs("button",{onClick:()=>b("dropcowboy"),className:`
                  flex items-center gap-2 px-4 py-4 border-b-2 font-medium text-sm transition-colors
                  ${E==="dropcowboy"?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"}
                `,children:[e.jsx("span",{className:"text-lg"}),e.jsx("span",{children:"Ringless Voicemail"})]}):e.jsx(e.Fragment,{})]})]})})}),e.jsxs("div",{className:"my-2 flex flex-col w-full p-1 bg-blue-50 border border-gray-100 rounded-md",children:[E==="dropcowboy"&&e.jsx(ft,{selectedClient:o}),E==="mautic"&&e.jsx(bt,{selectedClient:o})]}),e.jsxs("div",{className:"mb-6",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Select Service"}),e.jsxs("p",{className:"text-gray-500 mt-20s0 text-sm",children:["Choose a service for ",e.jsx("span",{className:"font-semibold",children:o.name})]})]}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Service"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Description"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Status"})]})}),e.jsxs("tbody",{className:"bg-white divide-y divide-gray-200",children:[e.jsxs("tr",{className:`transition-colors ${o.services.includes("mautic")?"hover:bg-gray-50 cursor-pointer":"cursor-not-allowed opacity-70 bg-gray-200 hover:bg-gray-200"}`,onClick:o.services.includes("mautic")?f:void 0,children:[e.jsxs("td",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:e.jsx(ee,{className:"w-6 h-6 text-blue-600"})}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Autovation"})]}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:"Email Marketing Campaigns"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${o.isActive?"bg-green-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:o.isActive?"Active":"Inactive"})]})})]}),e.jsxs("tr",{className:`transition-colors ${o.services.includes("dropcowboy")?"hover:bg-gray-50 cursor-pointer":"cursor-not-allowed opacity-70 bg-gray-100 hover:bg-gray-100"}`,onClick:o.services.includes("dropcowboy")?P:void 0,children:[e.jsxs("td",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:e.jsx(dt,{className:"w-6 h-6 text-green-500"})}),e.jsx("span",{className:"text-gray-900 font-medium",children:"Ringless Voicemail"})]}),e.jsx("td",{className:"px-4 py-3 text-gray-600",children:"Voicemail Campaigns"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${o.isActive?"bg-green-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:o.isActive?"Active":"Inactive"})]})})]})]})]})})]})},It=()=>{const{view:o,setView:n,selectedClient:f,setSelectedClient:P,setSelectedService:E,selectedCampaign:b,setSelectedCampaign:U,campaigns:D,setCampaigns:C,loadingCampaigns:$,setLoadingCampaigns:g}=je(),{user:u}=Te(),{hasFullAccess:A,hasPermission:_,isTeamManager:V}=at(u),[X,J]=a.useState([]),[H,K]=a.useState(!0),S=V,[R,I]=a.useState(!1),[v,M]=a.useState(null),[T,B]=a.useState([]),[Q,te]=a.useState({}),[h,l]=a.useState(""),[i,m]=a.useState("all"),[d,p]=a.useState(1),[w]=a.useState(10),[N,O]=a.useState({managerId:"",userIds:[]}),G=async()=>{try{const[t,s]=await Promise.all([Y.get("/api/mautic/clients"),Y.get("/api/clients")]),j=(t.data?.data||[]).map(x=>({...x,id:x.clientId||x.id,mauticApiId:x.id,uniqueId:`mautic-${x.clientId||x.id}`,services:["mautic"]})),k=s.data||[],se=k.filter(x=>x.clientType==="dropcowboy").map(x=>({...x,uniqueId:`dropcowboy-${x.id}`,services:["dropcowboy"]})),ie=new Map,we=new Map;for(const x of k){const F=x.name?.trim().toLowerCase();if(F){const W=ie.get(F)||[],xe=x.assignments||[],Re=new Map([...W.map(ce=>[ce.userId||ce.user?.id,ce]),...xe.map(ce=>[ce.userId||ce.user?.id,ce])]);ie.set(F,Array.from(Re.values()))}x.id&&we.set(x.id,x.assignments||[])}j.forEach(x=>{let F=null;if(x.clientId&&(F=we.get(x.clientId)),!F||F.length===0){const W=(x.name||"").trim().toLowerCase();F=ie.get(W)}F&&F.length>0&&(x.assignments=F)});const me=new Map;[...j,...se].forEach(x=>{const F=x.name.trim().toLowerCase();if(!me.has(F))me.set(F,{...x});else{const W=me.get(F),xe=Je=>(Je||[]).map(Se=>[Se.userId||Se.user?.id||Se.id,Se]),Re=new Map([...xe(W.assignments),...xe(x.assignments)]),ce={...W,id:W.id||x.id,mauticApiId:W.mauticApiId||x.mauticApiId||null,mauticUrl:W.mauticUrl||x.mauticUrl,isActive:W.isActive??x.isActive??!0,services:Array.from(new Set([...W.services||[],...x.services||[]])),assignments:Array.from(Re.values()),hasMautic:(W.services||[]).includes("mautic")||(x.services||[]).includes("mautic"),hasDropcowboy:(W.services||[]).includes("dropcowboy")||(x.services||[]).includes("dropcowboy")};me.set(F,ce)}});let ae=Array.from(me.values());A()||(S()?ae=ae.filter(x=>{const F=x.createdBy?.id===u.id,W=(x.assignments||[]).some(xe=>(xe.user?.id||xe.userId)===u.id);return F||W}):ae=ae.filter(x=>(x.assignments||[]).some(F=>(F.user?.id||F.userId)===u.id))),ae=ae.filter(x=>(x.services||[]).includes("mautic")||x.hasMautic),J(ae)}catch(t){console.error("Error fetching clients:",t)}finally{K(!1)}};a.useEffect(()=>{G(),S()&&de()},[u]);const de=async()=>{try{const t=await Y.get("/api/clients/assignment/managers");B(t.data.managers||t.data||[])}catch(t){console.error("Error fetching managers:",t)}},ge=async t=>{if(!t)return[];try{const j=(await Y.get(`/api/clients/assignment/managers/${t}/employees`)).data.employees||[];return te(k=>({...k,[t]:j})),j}catch(s){return console.error("Error fetching employees for manager:",s),[]}},pe=async()=>{try{const s=((await Y.get("/api/superadmin/employees")).data?.data||[]).map(j=>({id:j.id,name:j.name,email:j.email,role:j.role}));return te(j=>({...j,all:s})),s}catch(t){return console.error("Error fetching all employees:",t),[]}},Ie=t=>{P(t),n("services")},ue=async()=>{n("campaigns"),g(!0);try{const t=f.mauticApiId;if(!t){console.warn("No Mautic API ID found for this client"),g(!1);return}const s="",[j,k,se]=await Promise.all([Y.get(`${s}/api/mautic/clients/${t}/campaigns`),Y.get(`${s}/api/mautic/clients/${t}/segments`),Y.get(`${s}/api/mautic/clients/${t}/emails`)]),ie=k.data.data,we=se.data.data,me=j.data.data.map(ae=>{const x=we.filter(F=>F.name.toLowerCase().includes(ae.name.toLowerCase().split(":")[0]));return{...ae,emails:x,segments:ie}});C(me)}catch(t){console.error("Error fetching campaigns:",t)}finally{g(!1)}},Ne=()=>{n("dropcowboy")},ve=t=>{U(t),n("details")},he=()=>{n("clients"),P(null),E(null),U(null)},fe=()=>{n("services"),U(null)},ne=()=>{n("campaigns"),U(null)},le=async t=>{t.preventDefault();try{const s=N.managerId?parseInt(N.managerId):null,j=N.userIds||[];if(!s&&j.length===0)throw new Error("Please select at least a manager or an employee");if(s)try{await Y.post(`/api/clients/${v.id}/assign`,{userId:s})}catch(k){console.warn("Manager assign warning:",k?.response?.data||k.message)}for(const k of j)try{await Y.post(`/api/clients/${v.id}/assign`,{userId:k})}catch(se){console.warn("Employee assign warning:",se?.response?.data||se.message)}I(!1),O({managerId:"",userIds:[]}),M(null),G()}catch(s){console.error("Error assigning client:",s),alert(s.response?.data?.message||"Error assigning client")}},De=async(t,s,j=null)=>{if(window.confirm("Unassign this user from the client?"))try{const k=j||t;await Y.delete(`/api/clients/${k}/assign/${s}`),G()}catch(k){console.error("Error unassigning user:",k),alert(k.response?.data?.message||"Failed to unassign user")}},r=t=>{M(t);const s={managerId:"",userIds:[]};S()&&!A()&&(s.managerId=u.id.toString()),O(s),s.managerId&&ge(parseInt(s.managerId)),I(!0)},c=()=>{const t=v?.assignments?.map(s=>s.userId)||[];return S()&&!A()?T.filter(s=>s.id===u.id&&!t.includes(s.id)):T.filter(s=>!t.includes(s.id))},y=t=>{if(!t)return[];const s=v?.assignments?.map(k=>k.userId)||[],j=Q[t];return j?j.filter(k=>!s.includes(k.id)):(ge(parseInt(t)),[])},L=()=>{const t=v?.assignments?.map(j=>j.userId)||[],s=Q.all;return s?s.filter(j=>!t.includes(j.id)):(pe(),[])},Z=(()=>{let t=X;return h&&(t=t.filter(s=>s.name.toLowerCase().includes(h.toLowerCase()))),i!=="all"&&(t=t.filter(s=>i==="active"?s.isActive:!s.isActive)),t})(),oe=Math.ceil(Z.length/w),q=(d-1)*w,We=q+w,Xe=Z.slice(q,We),Pe=_("Clients","Update")||S();return H?e.jsx("div",{className:"flex justify-center items-center h-64",children:"Loading..."}):e.jsxs("div",{className:"container mx-auto px-4 pb-8 transition-all duration-300",children:[o==="clients"&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Clients"}),e.jsx("p",{className:"text-gray-500 mt-2 text-sm",children:"View and manage client assignments"})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-3 gap-4 mb-6",children:[e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Total Clients"}),e.jsx("div",{className:"text-2xl font-bold text-gray-900 mt-1",children:Z.length})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Active"}),e.jsx("div",{className:"text-2xl font-bold text-green-600 mt-1",children:Z.filter(t=>t.isActive).length})]}),e.jsxs("div",{className:"bg-white rounded-lg border border-gray-200 p-4",children:[e.jsx("div",{className:"text-sm text-gray-600",children:"Inactive"}),e.jsx("div",{className:"text-2xl font-bold text-gray-400 mt-1",children:Z.filter(t=>!t.isActive).length})]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow-md p-4 mb-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"md:col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Search"}),e.jsx("input",{type:"text",placeholder:"Search by name...",value:h,onChange:t=>{l(t.target.value),p(1)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Status"}),e.jsxs("select",{value:i,onChange:t=>{m(t.target.value),p(1)},className:"w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"all",children:"All Clients"}),e.jsx("option",{value:"active",children:"Active Only"}),e.jsx("option",{value:"inactive",children:"Inactive Only"})]})]})]})}),e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Client"}),e.jsx("th",{className:"px-4 py-3 text-left text-sm font-semibold text-gray-700",children:"Assigned"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Status"}),e.jsx("th",{className:"px-4 py-3 text-center text-sm font-semibold text-gray-700",children:"Actions"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:Xe.map(t=>e.jsxs("tr",{onClick:()=>Ie(t),className:"hover:bg-gray-50 cursor-pointer transition-colors",children:[e.jsxs("td",{className:"px-4 py-3 flex items-center gap-3",children:[e.jsx("div",{className:"h-10 w-10 bg-blue-100 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-blue-600 font-semibold",children:t.name.charAt(0).toUpperCase()})}),e.jsx("span",{className:"text-gray-900 font-medium",children:t.name})]}),e.jsx("td",{className:"px-4 py-3 text-gray-600 text-sm",children:t.assignments&&t.assignments.length>0?e.jsx("div",{className:"flex flex-col gap-1",children:t.assignments.slice().sort((s,j)=>{const k=s.user?.customRole?.fullAccess||s.user?.customRole?.isTeamManager||["superadmin","admin","manager"].includes(s.user?.role),se=j.user?.customRole?.fullAccess||j.user?.customRole?.isTeamManager||["superadmin","admin","manager"].includes(j.user?.role);return k===se?0:k?-1:1}).map(s=>{const j=s.user?.customRole?.fullAccess||s.user?.customRole?.isTeamManager||["superadmin","admin","manager"].includes(s.user?.role),k=j?"bg-purple-100 text-purple-800 border border-purple-200":"bg-green-100 text-green-800 border border-green-200",se=j?"Manager":"Employee";return e.jsxs("div",{className:"flex items-center gap-2",onClick:ie=>ie.stopPropagation(),children:[e.jsxs("span",{className:`inline-flex items-center gap-2 px-2 py-1 rounded-md text-sm ${k}`,children:[e.jsx("span",{className:"font-medium",children:s.user?.name||s.userName||"Unknown"}),e.jsx("span",{className:"text-xs px-1.5 py-0.5 rounded bg-opacity-50",children:se})]}),Pe&&!(u?.role==="manager"&&(s.user?.id||s.userId)===u.id)&&e.jsx("button",{onClick:ie=>{ie.stopPropagation(),De(t.id,s.userId,s.clientId)},title:"Unassign",className:"text-red-500 hover:text-red-700 px-1",children:"Ã—"})]},s.id||s.user?.id)})}):"-"}),e.jsx("td",{className:"px-4 py-3 text-center",children:e.jsxs("span",{className:"flex items-center justify-center gap-2",children:[e.jsx("span",{className:`w-3 h-3 rounded-full ${t.isActive?"bg-green-500":"bg-gray-400"}`}),e.jsx("span",{className:"text-sm font-medium",children:t.isActive?"Active":"Inactive"})]})}),e.jsx("td",{className:"px-4 py-3 flex justify-center gap-2",children:Pe&&e.jsx("button",{onClick:s=>{s.stopPropagation(),r(t)},className:"px-3 py-1 bg-green-50 text-green-600 rounded-lg hover:bg-green-100",children:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"})})})})]},t.uniqueId))})]})}),oe>1&&e.jsxs("div",{className:"mt-6 flex justify-center gap-2",children:[e.jsx("button",{onClick:()=>p(t=>Math.max(t-1,1)),disabled:d===1,className:"px-4 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Previous"}),[...Array(oe)].map((t,s)=>e.jsx("button",{onClick:()=>p(s+1),className:`px-4 py-2 rounded-lg ${d===s+1?"bg-blue-600 text-white":"border hover:bg-gray-50"}`,children:s+1},s+1)),e.jsx("button",{onClick:()=>p(t=>Math.min(t+1,oe)),disabled:d===oe,className:"px-4 py-2 border rounded-lg hover:bg-gray-50 disabled:opacity-50",children:"Next"})]})]}),o==="services"&&f&&e.jsx(yt,{selectedClient:f,goBackToClients:he,openMauticCampaigns:ue,openDropcowboyCampaigns:Ne}),o==="campaigns"&&f&&e.jsx(ht,{campaigns:D,selectedClient:f,loadingCampaigns:$,goBackToServices:fe,openCampaignDetails:ve}),o==="details"&&f&&b&&e.jsx(pt,{campaigns:D,selectedCampaign:b,setSelectedCampaign:U,goBackToCampaigns:ne}),o==="dropcowboy"&&f&&e.jsxs("div",{className:"animate-fade-in",children:[e.jsxs("button",{onClick:fe,className:"flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6",children:[e.jsx(Fe,{className:"w-5 h-5"}),e.jsxs("span",{className:"font-medium",children:["Back to ",f.name," Services"]})]}),e.jsxs("h2",{className:"text-xl font-semibold mb-4",children:[f.name," â€” Ringless Voicemail Dashboard"]}),e.jsx(ut,{clientName:f.name})]}),R&&e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:e.jsxs("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"Assign Client"}),e.jsxs("p",{className:"text-gray-600 mb-4",children:["Assign ",e.jsx("strong",{children:v?.name})," to:"]}),e.jsxs("form",{onSubmit:le,className:"space-y-4",children:[["superadmin","admin","manager"].includes(u?.role)&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Manager"}),N.managerId?e.jsx("div",{className:"flex items-center gap-2 mb-2",children:e.jsxs("span",{className:"inline-flex items-center gap-2 bg-purple-100 text-purple-800 px-3 py-2 rounded-lg border border-purple-200",children:[e.jsx("span",{className:"text-xs font-semibold bg-purple-600 text-white px-1.5 py-0.5 rounded",children:"Manager"}),e.jsx("span",{className:"font-medium",children:T.find(t=>t.id===parseInt(N.managerId))?.name||"Selected"}),e.jsx("button",{type:"button",onClick:()=>O({...N,managerId:""}),className:"text-purple-600 hover:text-purple-800 ml-1",children:"âœ•"})]})}):e.jsxs("select",{value:N.managerId,onChange:t=>{const s=t.target.value;O({...N,managerId:s}),s&&ge(parseInt(s))},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"(Optional) Select Manager"}),c().map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.email,")"]},t.id))]})]}),(N.managerId||u?.role==="superadmin"||u?.role==="admin")&&e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Employee(s)"}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-2",children:(N.userIds||[]).map(t=>{const j=(N.managerId?Q[N.managerId]||[]:Q.all||[]).find(k=>k.id===t)||{name:`User ${t}`};return e.jsxs("span",{className:"inline-flex items-center gap-2 bg-blue-50 text-blue-800 px-3 py-2 rounded-lg border border-blue-200",children:[e.jsx("span",{className:"text-xs font-semibold bg-blue-600 text-white px-1.5 py-0.5 rounded",children:"Employee"}),e.jsx("span",{className:"font-medium",children:j.name}),e.jsx("button",{type:"button",onClick:()=>O({...N,userIds:N.userIds.filter(k=>k!==t)}),className:"text-blue-600 hover:text-blue-800 ml-1",children:"âœ•"})]},t)})}),e.jsxs("select",{defaultValue:"",onChange:t=>{const s=t.target.value?parseInt(t.target.value,10):null;s&&(N.userIds.includes(s)||O({...N,userIds:[...N.userIds,s]}),t.target.value="")},className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500",children:[e.jsx("option",{value:"",children:"Add employee..."}),(N.managerId?y(N.managerId):L()).map(t=>e.jsxs("option",{value:t.id,children:[t.name," (",t.email,")"]},t.id))]})]}),e.jsxs("div",{className:"flex justify-end gap-2 pt-4",children:[e.jsx("button",{type:"button",onClick:()=>{I(!1),M(null),O({managerId:"",userIds:[]})},className:"px-4 py-2 border rounded-lg hover:bg-gray-50",children:"Cancel"}),e.jsx("button",{type:"submit",disabled:!(N.userIds?.length>0||N.managerId),className:"px-4 py-2 bg-green-500 text-white rounded-lg hover:bg-green-600 disabled:opacity-50",children:"Assign"})]})]})]})})]})};export{It as default};
//# sourceMappingURL=Clients-D-hZwlPZ.js.map
